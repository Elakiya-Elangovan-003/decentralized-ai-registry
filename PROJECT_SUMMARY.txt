# Decentralized AI Model Registry

A smart contract protocol for registering and accessing AI models on Ethereum with ERC20-based settlement.

## ğŸ¯ Project Description

Designed smart contract architecture for decentralized AI model registration, implemented ERC20-based access and usage settlement logic, and explored storage layout optimization for gas efficiency and protocol safety.

## ğŸ—ï¸ Architecture

### Core Components

1. **AIModelRegistry.sol** - Main registry contract
   - Model registration with IPFS hash storage
   - ERC20 payment settlement for access
   - Access control logic
   - Gas-optimized storage layout

2. **MockToken.sol** - ERC20 token for testing
   - Standard ERC20 implementation
   - Used for access payments

### Smart Contract Features

- **Model Registration**: Owners register AI models with metadata stored on IPFS
- **ERC20 Settlement**: Users pay tokens to access models (approve + transferFrom pattern)
- **Access Control**: Only users who paid can retrieve IPFS hashes
- **Gas Optimization**: Struct packing reduces storage costs

## ğŸ“Š Gas Optimization Results

| Operation | Gas Used | Optimization |
|-----------|----------|--------------|
| Model Registration | 161,301 | Struct packing (address + uint64) |
| Access Purchase | 71,462 | Minimal storage writes |

### Storage Optimizations Applied

1. **Struct Packing**: `address owner` (20 bytes) + `uint64 timestamp` (8 bytes) in single slot
2. **bytes32 for IPFS**: Using `bytes32` instead of `string` for CID storage
3. **Immutable Variables**: Payment token address set once in constructor
4. **Events Over Storage**: Emit events for off-chain indexing instead of storing all data

## ğŸ§ª Test Coverage

15 comprehensive tests covering:
- Contract deployment
- Model registration (happy path + validation)
- ERC20 payment settlement
- Access control logic
- IPFS hash retrieval
- Gas consumption verification

All tests passing âœ…

## ğŸš€ Technology Stack

- **Solidity**: ^0.8.28
- **Hardhat**: v3.1.5
- **Ethers.js**: v6.14.0
- **TypeScript**: ~5.8.0
- **Chai**: Testing framework

## ğŸ“ Project Structure
```
decentralized-ai-registry/
â”œâ”€â”€ contracts/
â”‚   â”œâ”€â”€ AIModelRegistry.sol    # Main registry contract
â”‚   â””â”€â”€ MockToken.sol           # ERC20 test token
â”œâ”€â”€ test/
â”‚   â””â”€â”€ AIModelRegistry.test.ts # Comprehensive tests
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ demo.ts                 # Demo workflow
â”œâ”€â”€ hardhat.config.ts
â””â”€â”€ package.json
```

## ğŸ® Usage

### Install Dependencies
```bash
npm install
```

### Compile Contracts
```bash
npx hardhat compile
```

### Run Tests
```bash
npx hardhat test
```

### Run Demo
```bash
npx hardhat run scripts/demo.ts
```

## ğŸ’¡ Key Implementation Details

### Model Registration
```solidity
function registerModel(
    string calldata _name,
    bytes32 _ipfsHash,
    uint256 _accessPrice
) external returns (uint256)
```

### Access Purchase (ERC20 Settlement)
```solidity
function purchaseAccess(uint256 _modelId) external
```
- User must first `approve()` tokens to registry
- Registry calls `transferFrom()` to transfer payment to model owner
- Access granted after successful payment

### IPFS Hash Retrieval
```solidity
function getModelIPFS(uint256 _modelId) external view returns (bytes32)
```
- Returns IPFS hash only if caller has access
- Returns `bytes32(0)` otherwise

## ğŸ“ˆ Results

- âœ… Zero-cost development (local Hardhat network)
- âœ… Gas-optimized smart contracts
- âœ… Complete test coverage (15/15 passing)
- âœ… Working ERC20 settlement logic
- âœ… IPFS integration ready (off-chain storage with on-chain hashes)

## ğŸ” Security Considerations

- Access control prevents unauthorized IPFS hash retrieval
- ERC20 approve/transferFrom pattern prevents reentrancy
- Input validation on all registration functions
- Immutable payment token prevents upgrade attacks

## ğŸ“ Future Enhancements

- Multi-token support (accept different ERC20s)
- Usage-based pricing (pay per inference)
- Model versioning system
- Governance for protocol parameters

## ğŸ† Project Status

**Completed**: All core features implemented and tested locally.

**Development Time**: ~3-4 hours

**Cost**: $0 (local development only)